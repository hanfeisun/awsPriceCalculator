{"version":3,"sources":["cal.js"],"names":[],"mappings":"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","file":"cal-compiled.js","sourcesContent":["\"use strict\";\n\n// Utils\nvar $ = function (idSelector) {\n        return document.getElementById.apply(document, [idSelector.replace(\"#\", \"\")])\n    },\n    parse = function (selector) {\n        return parseFloat($(selector).value)\n    },\n\n    step_minus = function (a, b) {\n        if (a < b) {\n            return 0\n        } else {\n            return a - b\n        }\n    };\n\n\nvar View = {\n    subscribe: function (selector) {\n        var self = this,\n            e = $(selector);\n\n        e.oninput = function () {\n            self.model.notify();\n            self.update();\n        };\n        e.onpropertychange = e.oninput;\n    },\n    bind: function (selector, propFunc) {\n        this.bindList[selector] = propFunc;\n    },\n    update: function () {\n        for (var selector in this.bindList) {\n            $(selector).innerText = this.model[this.bindList[selector]]().toFixed(2);\n        }\n    }\n\n};\n\n\nvar AwsView = function (awsModel) {\n    this.model = awsModel;\n    this.subscribe(\"#p_user\");\n    this.subscribe(\"#p_user\");\n    this.subscribe(\"#p_new_moment\");\n    this.subscribe(\"#p_avg_length\");\n    this.subscribe(\"#p_audience\");\n    this.subscribe(\"#p_session\");\n    this.subscribe(\"#p_session_length\");\n    this.subscribe(\"#p_mbps\");\n    this.bindList = {};\n    this.bind(\"#v_s3\", \"s3\");\n    this.bind(\"#v_transcoder\", \"transcoder\");\n    this.bind(\"#v_cdn\", \"cdn\");\n    this.bind(\"#v_total\", \"total\");\n    this.bind(\"#v_up\", \"d_upload_GB\");\n    this.bind(\"#v_down\", \"d_download_GB\");\n    this.bind(\"#v_up_c\", \"d_upload_cumulative_GB\");\n};\n\nAwsView.prototype = View;\n\n\nvar AwsModel = function () {\n    this.notify = this.parseAll;\n    this.notify()\n};\n\n\nAwsModel.prototype.parseAll = function () {\n    this.p_user = parse(\"#p_user\");\n    this.p_new_moment = parse(\"#p_new_moment\");\n    this.p_avg_minute = parse(\"#p_avg_length\");\n    this.p_audience = parse(\"#p_audience\");\n    this.p_session = parse(\"#p_session\");\n    this.p_session_minute = parse(\"#p_session_length\");\n    this.p_mbps = parse(\"#p_mbps\");\n};\n\nAwsModel.prototype.t_upload_minute = function () {\n    return this.p_user * this.p_new_moment * this.p_avg_minute\n};\n\nAwsModel.prototype.t_acc_minute = function () {\n    // TODO: use real cumulative length\n    return this.t_upload_minute()\n};\n\nAwsModel.prototype.t_download_minute = function () {\n\n    return this.p_audience * this.p_session * this.p_session_minute\n};\n\n\nAwsModel.prototype.data_size_GB = function (minute) {\n    return (minute * 60 * this.p_mbps) / (8 * 1024);\n};\n\nAwsModel.prototype.d_upload_GB = function () {\n    return this.data_size_GB(this.t_upload_minute());\n};\n\nAwsModel.prototype.d_upload_cumulative_GB = function () {\n    return this.data_size_GB(this.t_acc_minute());\n};\n\nAwsModel.prototype.d_download_GB = function () {\n    return this.data_size_GB(this.t_download_minute());\n};\n\nAwsModel.prototype.s3 = function () {\n\n    // https://aws.amazon.com/s3/pricing/\n    // Note: \"Standard - Infrequent Access Storage\" price in United States\n    // Actual price is $0.125 per GB, use $0.13 to compensate Request price\n    return 0.13 * this.d_upload_cumulative_GB();\n};\n\n\nAwsModel.prototype.transcoder = function () {\n    // https://aws.amazon.com/elastictranscoder/pricing/\n    return 0.03 * this.d_upload_GB();\n};\n\n\nAwsModel.prototype.cdn = function () {\n    var up_size = this.d_upload_GB(),\n        down_size = this.d_download_GB();\n\n    // https://aws.amazon.com/cloudfront/pricing/\n\n\n    var up_price = up_size * 0.02,\n        down_price =\n            Math.min(down_size, 10000) * 0.085 +\n            Math.min(step_minus(down_size, 10000), 40000) * 0.08 +\n            Math.min(step_minus(down_size, 50000), 100000) * 0.06 +\n            Math.min(step_minus(down_size, 150000), 350000) * 0.04 +\n            Math.min(step_minus(down_size, 500000), 524000) * 0.03 +\n            Math.min(step_minus(down_size, 1024000), 4000000) * 0.025 +\n            step_minus(down_size, 5024000) * 0.020;\n    return up_price + down_price\n};\n\n\nAwsModel.prototype.total = function () {\n    return this.s3() + this.transcoder() + this.cdn();\n}"]}